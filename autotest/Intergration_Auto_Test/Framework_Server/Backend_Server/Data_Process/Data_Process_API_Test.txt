*** Settings ***
Suite Setup       Login Some Server
Suite Teardown    #Clear Backend Environment
Force Tags        Siqi.Zeng
Resource          ../../../Resource/RFresource/Framwork Server/Backend-Server/Data-Processor/Data-Processor_lib_res_var.txt

*** Test Cases ***
RDB-23108_post_/commands/{commond_name}/executions_with_cmdname_exist
    [Documentation]    | Description | test post:/commands/{commond_name}/executions API normal execute flow |
    ...    | Input | snippets |
    ...    | Process | call Data Process API to send requast |
    ...    | Expect result | 1.return code 200,content is done |
    ...    | remark | for data processor do not care the type of flow, so in this case, use rdb-server-snippetAnalyzer-cmd.jar flow to represent others |
    [Tags]    level_1    normal
    [Setup]    Clear Environment and Trigger Snippets    ${gMountLocalFolder}/Framework/Data-Process/RDB-23108
    [Timeout]    5 minutes
    Print Input Line
    log    ${sSnippetList}
    Print Execute Line
    Post Request to Execution API    --cmd snippetAnalyzer --base-dir ${gFileStoragePath} --work-dir ${gWorkPath}/WorkflowManager/SnippetAnalyzer --segment-config /usr/local/ygomi/roadDB/algo_res/SegmentConfig.json --db ${gDbApiUrlofDocker} --data-processor http://${gBackendsIp[0]}:${sDataProcessorPort}/DataProcessor --thread-pool-size 10 --db-limit-number 1000 --unzip-dir /WorkflowManager/unzip --storage-source LOCAL --confidence 100.0 --remote-filestorage http://${gBackendsIp[0]}:8088 --accesskey 111 --secretkey 111 --endpoint --region us-east-1 --bucket ygomi-fws --debug    rdb-server-snippetAnalyzer-cmd.jar
    Print Check Results Line
    run keyword and continue on failure    should be equal as strings    ${response.status_code}    200    api return code should be equal as 200
    run keyword and continue on failure    should contain    ${response.content}    "ret_code":0    api return content should contain "ret_code":0
    run keyword and continue on failure    should contain    ${response.content}    "status":"done"    api return content should contain "std_out":"","status":"done"
    [Teardown]    Backup Test Results    @{sDataProcessorBackupList}

RDB-23144_post_/commands/{commond_name}/executions_with_command_no_execute_permission
    [Documentation]    | Description | test post:/commands/{commond_name}/executions API with_command_no_execute_permission |
    ...    | Input | snippets |
    ...    | Process | call Data Process API to send requast |
    ...    | Expect result | 1.return code 200,content is done |
    ...    | remark | for data processor do not care the type of flow, so in this case, use rdb-server-snippetAnalyzer-cmd.jar flow to represent others |
    [Tags]    level_1
    [Setup]    Prepare Environment for RDB-23144    ${gMountLocalFolder}/Framework/Data-Process/RDB-23108
    [Timeout]    5 minutes
    Print Input Line
    log    ${sSnippetList}
    Print Execute Line
    Post Request to Execution API    --cmd snippetAnalyzer --base-dir ${gFileStoragePath} --work-dir ${gWorkPath}/WorkflowManager/SnippetAnalyzer --segment-config /usr/local/ygomi/roadDB/algo_res/SegmentConfig.json --db ${gDbApiUrlofDocker} --data-processor http://${gBackendsIp[0]}:${sDataProcessorPort}/DataProcessor --thread-pool-size 10 --db-limit-number 1000 --unzip-dir /WorkflowManager/unzip --storage-source LOCAL --confidence 100.0 --remote-filestorage http://${gBackendsIp[0]}:8088 --accesskey 111 --secretkey 111 --endpoint --region us-east-1 --bucket ygomi-fws --debug    rdb-server-snippetAnalyzer-cmd.jar
    Print Check Results Line
    run keyword and continue on failure    should be equal as strings    ${response.status_code}    200    api return code should be equal as 200
    run keyword and continue on failure    should contain    ${response.content}    "ret_code":0    api return content should contain "ret_code":0
    run keyword and continue on failure    should contain    ${response.content}    "status":"done"    api return content should contain "std_out":"","status":"done"
    [Teardown]    Backup Test Results    @{sDataProcessorBackupList}    #Backup Test Results | @{sDataProcessorBackupList}

RDB-24985_post_/commands/{commond_name}/executions_with_cmdname_not_exist
    [Documentation]    | Description | test post:/commands/{commond_name}/executions API normal execute flow |
    ...    | Input | snippets |
    ...    | Process | call Data Process API to send requast |
    ...    | Expect result | 1.return code 404,content is done |
    [Tags]    level_3
    [Setup]
    [Timeout]    3 minutes
    Print Input Line
    log    null
    Print Execute Line
    Post Request to Execution API    \    test-command-name    \    false
    Print Check Results Line
    run keyword and continue on failure    should be equal as strings    ${response.status_code}    404    api return code(${response.status_code}) should be equal as 404
    run keyword and continue on failure    should contain    ${response.content}    command name is not exists    api return content(${response.content}) should contain "command name is not exists"
    [Teardown]    Backup Test Results    @{sDataProcessorBackupList}    #Backup Test Results | @{sDataProcessorBackupList}

RDB-23116_post_/commands/{commond_name}/executions_with_miss_flow_required_params
    [Documentation]    | Description | test post:/commands/{commond_name}/executions API with_miss_required_params |
    ...    | Input | |
    ...    | Process | call Data Process API to send requast |
    ...    | Expect result | return code 200,error message is correct |
    [Tags]    level_3
    [Setup]
    [Timeout]    3 minutes
    Print Input Line
    log    null
    Print Execute Line
    Post Request to Execution API    \    rdb-server-snippetAnalyzer-cmd.jar
    Print Check Results Line
    run keyword and continue on failure    should be equal as strings    ${response.status_code}    200    api return code(${response.content}) should be equal as 200
    run keyword and continue on failure    should contain    ${response.content}    "ret_code":1,"std_out":"","status":"done"    api return content should contain "ret_code":1,"std_out":"","status":"done"
    [Teardown]    Backup Test Results    @{sDataProcessorBackupList}    #Backup Test Results | @{sDataProcessorBackupList}

RDB-25060_post_/commands/{commond_name}/executions_with_asyn_true
    [Documentation]    | Description | test post:/commands/{commond_name}/executions API with asyn is true |
    ...    | Input | |
    ...    | Process | call Data Process API to send requast |
    ...    | Expect result | return 202 code |
    [Tags]    level_3
    [Setup]
    [Timeout]    3 minutes
    Print Input Line
    log    null
    Print Execute Line
    Post Request to Execution API    \    rdb-server-snippetAnalyzer-cmd.jar    true
    Print Check Results Line
    run keyword and continue on failure    should be equal as strings    ${response.status_code}    202    api return code(${response.content}) should be equal as 202
    run keyword and continue on failure    should be equal as strings    ${tContentType}    <type 'int'>    api return content should be a int number , it is a execution id
    [Teardown]    Backup Test Results    @{sDataProcessorBackupList}    #Backup Test Results | @{sDataProcessorBackupList}

RDB-25077_get_/commands/{commond_name}/executions/{execution_id}_with_cmdname_not_exist
    [Documentation]    | Description | test get:/commands/{commond_name}/executions/{execution_id} API normal execute flow |
    ...    | Input | |
    ...    | Process | call Data Process API to send requast |
    ...    | Expect result | 1.return code 404, |
    [Tags]    level_3
    [Setup]
    [Timeout]    3 minutes
    Print Input Line
    log    null
    Print Execute Line
    Get Request to Execution API    100    test-command-name    \    false
    Print Check Results Line
    run keyword and continue on failure    should be equal as strings    ${response.status_code}    404    api return code(${response.status_code}) should be equal as 404
    run keyword and continue on failure    should contain    ${response.content}    command name is not exists    api return content(${response.content}) should contain "command name is not exists"
    [Teardown]    Backup Test Results    @{sDataProcessorBackupList}    #Backup Test Results | @{sDataProcessorBackupList}

RDB-25077_get_/commands/{commond_name}/executions/{execution_id}_with_execution_id_not_exist
    [Documentation]    | Description | test get:/commands/{commond_name}/executions/{execution_id} API with not exist execution id |
    ...    | Input | |
    ...    | Process | call Data Process API to send requast |
    ...    | Expect result | 1.return code 404, |
    [Tags]    level_3
    [Setup]
    [Timeout]    3 minutes
    Print Input Line
    log    null
    Print Execute Line
    Get Request to Execution API    1    rdb-server-snippetAnalyzer-cmd.jar    \    false
    Print Check Results Line
    run keyword and continue on failure    should be equal as strings    ${response.status_code}    404    api return code(${response.status_code}) should be equal as 404
    run keyword and continue on failure    should contain    ${response.content}    Command execution id is not exists.    api return content(${response.content}) should contain "Command execution id is not exists."
    [Teardown]    Backup Test Results    @{sDataProcessorBackupList}    #Backup Test Results | @{sDataProcessorBackupList}
